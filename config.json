{
  "HTTP": {
    "Addr": "127.0.0.1:8080"
  },
  "Handlers": [
    {
      "Latest": {
        "Consumer": {
          "Format": "json",
          "Queue": {
            "Nsq": {
              "Addr": "127.0.0.1:4150",
              "Channel": "platypus-latest",
              "ConsumerBufferSize": 128,
              "LogLevel": "info",
              "Topic": "ticker"
            },
            "Type": "nsq"
          }
        },
        "Format": "json",
        "Key": "{{.market}}|{{(index .currencyPair 0).symbol}}|{{(index .currencyPair 1).symbol}}",
        "Store": {
          "MemoryTTL": {
            "Resolution": "1m",
            "TTL": "24h"
          },
          "Type": "memoryttl"
        }
      },
      "Method": "get",
      "Path": "/api/v1/tickers",
      "Type": "latest"
    },
    {
      "Latests": {
        "Format": "json",
        "Inputs": [
          {
            "Consumer": {
              "Format": "json",
              "Queue": {
                "Nsq": {
                  "Addr": "127.0.0.1:4150",
                  "Channel": "platypus-tc-latests",
                  "ConsumerBufferSize": 128,
                  "Topic": "ticker"
                },
                "Type": "nsq"
              }
            },
            "Key": "{{.market}}|{{(index .currencyPair 0).symbol}}|{{(index .currencyPair 1).symbol}}",
            "Store": {
              "MemoryTTL": {
                "Resolution": "1m",
                "TTL": "24h"
              },
              "Type": "memoryttl"
            }
          },
          {
            "Consumer": {
              "Format": "json",
              "Queue": {
                "Nsq": {
                  "Addr": "127.0.0.1:4150",
                  "Channel": "platypus-tc-latests",
                  "ConsumerBufferSize": 128,
                  "Topic": "change"
                },
                "Type": "nsq"
              }
            },
            "Key": "{{.period}}|{{(index .currencyPair 0).symbol}}|{{(index .currencyPair 1).symbol}}",
            "Store": {
              "MemoryTTL": {
                "Resolution": "1m",
                "TTL": "24h"
              },
              "Type": "memoryttl"
            }
          }
        ],
        "Wrap": "{{\"{\"}}{{range $i, $e := $}}{{if $i}},{{end}}\"{{- $e.Input.Consumer.Queue.Nsq.Topic -}}\":{{- (printf \"%s\" $e.Events.JSON) -}}{{end}}{{\"}\"}}"
      },
      "Method": "get",
      "Path": "/api/v1/tickers-changes",
      "Type": "latests"
    },
    {
      "Method": "get",
      "Path": "/api/v1/tickers/stream",
      "Stream": {
        "Consumer": {
          "Format": "json",
          "Queue": {
            "Nsq": {
              "Addr": "127.0.0.1:4150",
              "Channel": "platypus-stream",
              "ConsumerBufferSize": 128,
              "LogLevel": "info",
              "Topic": "ticker"
            },
            "Type": "nsq"
          }
        },
        "Format": "json",
        "Writer": {
          "Pool": {
            "QueueSize": 1024,
            "Workers": 128
          },
          "ScheduleTimeout": "10s"
        }
      },
      "Type": "stream"
    },
    {
      "Method": "get",
      "Path": "/api/v1/tickers-changes/stream",
      "Streams": {
        "Format": "json",
        "Inputs": [
          {
            "Consumer": {
              "Format": "json",
              "Queue": {
                "Nsq": {
                  "Addr": "127.0.0.1:4150",
                  "Channel": "platypus-tc-streams",
                  "ConsumerBufferSize": 128,
                  "Topic": "ticker"
                },
                "Type": "nsq"
              }
            }
          },
          {
            "Consumer": {
              "Format": "json",
              "Queue": {
                "Nsq": {
                  "Addr": "127.0.0.1:4150",
                  "Channel": "platypus-tc-streams",
                  "ConsumerBufferSize": 128,
                  "Topic": "change"
                },
                "Type": "nsq"
              }
            }
          }
        ],
        "Wrap": "{\"type\":\"{{- .Input.Consumer.Queue.Nsq.Topic -}}\",\"payload\":{{- (printf \"%s\" .Event.JSON) -}}}",
        "Writer": {
          "Pool": {
            "QueueSize": 1024,
            "Workers": 128
          },
          "ScheduleTimeout": "10s"
        }
      },
      "Type": "streams"
    }
  ],
  "Logger": {
    "Formatter": "json",
    "Level": "info"
  }
}
